import Head from "next/head";
import { IAnime } from "types/anime";
import { getAnimes } from "pages/api/animes";
import { GetServerSideProps, InferGetServerSidePropsType } from "next";
import { useState } from "react";
import Table from "components/Table";

const Home = ({
  data: defaultAnimes,
}: InferGetServerSidePropsType<typeof getServerSideProps>) => {
  const [animes, setAnimes] = useState<IAnime[]>(defaultAnimes);

  return (
    <div>
      <Head>
        <title>Create Next App</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <main className="min-h-screen">
        <Table data={animes} />
      </main>
    </div>
  );
};

export const getServerSideProps: GetServerSideProps<{
  data: IAnime[];
}> = async (context) => {
  let animes: IAnime[] = [];

  try {
    animes = JSON.parse(JSON.stringify(await getAnimes()));
  } catch (error) {}

  return {
    props: {
      data: animes,
    },
  };
};

export default Home;
